<!DOCTYPE HTML>
<html>
  <head>
    <title>Categories</title>
    <meta name="renderer" content="webkit">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="./css/base.css" />
    <link rel="stylesheet" type="text/css" href="./css/global.css" />
    <link rel="stylesheet" type="text/css" href="./css/category.css" />
  </head>
<body>
    <div id="view">
      <header id="header">
        <div class="header-wrap fn-clear">
          <div class="page-nav">
            <ul class="fn-clear">
              <li><a href="./home.html">Home</a></li>
              <li><a href="./category.html">Fundraiser</a></li>
              <li><a href="./about.html">About</a></li>
              <li><a href="./login.html">Sign in</a></li>
              <li class="login"><a class="ui-button-green" href="javascript:;">Start a GoFoundMe</a></li>
            </ul>
          </div>
        </div>
      </header>
      <div id="intro" class="fn-clear">
        <div class="title-content fn-left">
          <h2 class="title">Browse fundraisers by category</h2>
          <p class="des">People around the world are raising money for what they are passionate about.</p>
        </div>
        <div class="logo-content fn-right">
          <div class="logo">
            <img src="images/category-logo.png" />
          </div>
        </div>
      </div>
    </div>
    <div class="search-box">
      <input type="text" id="keywords" placeholder="Please enter keywords.">
      <div class="clear-box">
        <button id="clearBtn" class="clear">
          <svg viewBox="0 0 448 512" class="svgIcon">
            <path
              d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z">
            </path>
          </svg>
        </button>
      </div>
    </div>
    <div id="functions" class="fn-clear">
      <div class="wrapper-title">Category</div>
      <div class="functions-wrapper">
        <div id="list" class="list"></div>
      </div>
    </div>
    <div class="btn-box">
      <button id="searchBtn" class="search">
        Search
      </button>
    </div>
    <script>
      (function () {
        getCategory()
      })()
      function getCategory(id) {
          fetch('http://localhost:8085/category').then(res => {
            return res.json()
          }).then(response => {
            const list = document.querySelector('#list')
            var data = response.data
            let text = ''
            data.forEach(item => {
              text += `
                <div class="item">
                  <input type="checkbox" id="`+ item.CATEGORY_ID + `" name="category" value="` + item.CATEGORY_ID + `">
                  <label for="`+ item.CATEGORY_ID + `">` + item.NAME + `</label>
                </div>
              `
            })
            list.innerHTML = text
            addEvent()
          })
        }
      function addEvent() {   
        const searchBtn = document.getElementById('searchBtn');
        const clearBtn = document.getElementById('clearBtn');
        const inputValue = document.querySelector('#keywords')
        const checkboxes = document.querySelectorAll('#list input[type="checkbox"]');
        searchBtn.addEventListener('click', search);
        clearBtn.addEventListener('click', clearChechboxes);
        function getSelectedCategories() {
          return Array.from(checkboxes)
            .filter(checkbox => checkbox.checked)
            .map(checkbox => checkbox.value);
        }
        function search() {
          const selectedCategories = getSelectedCategories();
          if (!inputValue.value && selectedCategories.length == 0) {
            alert('Please select category')
            return
          }
          if (selectedCategories.length > 0) {
            const ids = selectedCategories.join(', ');
            window.location.href='./fundariser.html?category='+ids+'&organizer='+ inputValue.value
          } else {
            window.location.href = './fundariser.html?organizer=' + inputValue.value
          }
        }
        function clearChechboxes() {
          checkboxes.forEach(checkbox => {
            checkbox.checked = false;
            checkbox.nextElementSibling.style.backgroundColor = '';
            checkbox.nextElementSibling.style.color = '';
          });
        }
      }
    </script>
  </body>
</html>