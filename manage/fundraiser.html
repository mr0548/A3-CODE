<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>后台管理</title>
    <link rel="stylesheet" type="text/css" href="css/common.css"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>
</head>
<body>
<div class="topbar-wrap white">
    <div class="topbar-inner clearfix">
        <div class="topbar-logo-wrap clearfix">
            <h1 class="topbar-logo">BackendManagement</h1>
        </div>
        <div class="top-info-wrap">
            <ul class="top-info-list clearfix">
                <li><a href="#">manager</a></li>
                <li><a href="#">LOG OUT</a></li>
            </ul>
        </div>
    </div>
</div>
<div class="container clearfix">
    <div class="sidebar-wrap">
        <div class="sidebar-title">
            <h1>MENU</h1>
        </div>
        <div class="sidebar-content">
            <ul class="sidebar-list">
                <li>
                    <a href="#"><i class="icon-font">&#xe003;</i>FUNDRAISER</a>
                    <ul class="sub-menu">
                        <li><a href="insert.html"><i class="icon-font">&#xe005;</i>ADD</a></li>
                        <li><a style="color: cornflowerblue;" href="fundraiser.html"><i class="icon-font">&#xe005;</i>DATALIST</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
    <div class="main-wrap">
        <div class="crumb-wrap">
            <div class="crumb-list"><i class="icon-font"></i><a href="#">FUNDRAISER</a></div>
        </div>
        <div class="search-wrap">
            <div class="search-content">
                <form action="#" method="post">
                    <table class="search-tab">
                        <tr>
                            <th width="120">categories:</th>
                            <td>
                                <select style="height: 28.6px; width: 200px;" name="search-sort" id="category_select"></select>
                            </td>
                            <td><div class="btn btn-primary btn2" onclick="getList()">search</div></td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>
        <div class="result-wrap">
            <form name="myform" id="myform" method="post">
                <div class="result-content">
                    <table id="list" class="result-tab" width="100%"></table>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    (function() {
        getCategory()
        getList()
    })()
    function getCategory() {
        fetch('http://localhost:8085/category').then(res => {
            return res.json()
        }).then(response => {
            const list = document.querySelector('#category_select')
            let text = `<option value="">All</option>`
            response.data.forEach(item => {
                text += `<option value="` + item.CATEGORY_ID + `">` + item.NAME + `</option>`
            })
            list.innerHTML = text
        })
    }
    function getList() {
        const category = document.querySelector('#category_select').value
        fetch(`http://localhost:8085/search?category=${category}&organizer=''`).then(res => {
            return res.json()
        }).then(response => {
            const list = document.querySelector('#list')
            let text = `
                    <tr>
                        <th style="text-align: center;">ID</th>
                        <th style="text-align: center;">CAPTION</th>
                        <th style="text-align: center;">ORGANIZER</th>
                        <th style="text-align: center;">CATEGORY</th>
                        <th style="text-align: center;">CURRENT</th>
                        <th style="text-align: center;">TARGET</th>
                        <th style="text-align: center;">CITY</th>
                        <th style="text-align: center;">STATUS</th>
                        <th style="text-align: center;">OPERATION</th>
                    </tr>
                `
            if (response.data.length) {
                response.data.forEach((element, index) => {
                    text += `
                            <tr>
                                <td style="text-align: center;">`+ (index + 1) + `</td>
                                <td style="text-align: center;">`+ element.CAPTION + `</td>
                                <td style="text-align: center;">`+ element.ORGANIZER + `</td>
                                <td style="text-align: center;">`+ element.NAME + `</td>
                                <td style="text-align: center;">`+ element.CURRENT_FUNDING + `</td>
                                <td style="text-align: center;">`+ element.TARGET_FUNDING + `</td>
                                <td style="text-align: center;">`+ element.CITY + `</td>
                                <td style="text-align: center;">`+ ((element.ACTIVE == 1) ? 'ACTIVE' : 'SUSPENDED') + `</td>
                                <td style="text-align: center;">
                                    <a href="insert.html?id=`+ element.FUNDRAISER_ID + `">UPDATE</a>
                                    <a style="color: red;" href="#" onclick="deleteItem(`+ element.FUNDRAISER_ID + `)">DELETE</a>
                                </td>
                            </tr>
                        `
                });
            }
            list.innerHTML = text
        })
    }
    function deleteItem(id) {
        fetch(`http://localhost:8085/removeFundraiser/${id}`, {
            method: 'DELETE',
        })
            .then((response) => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then((data) => {
                getList()
            })
            .catch((error) => {
                console.error('Error:', error);
            });
    }
</script>
</body>
</html>